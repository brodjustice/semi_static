- obj = @entry || @tag
- @tag ||= entrytag
- obj ||= entrytag

%aside
  = yield :side_bar_top
  - if side_bar_nav? && !obj.get_page_attr('disableSideBarNav')
    .panel.list
      %nav
        - if SemiStatic::Tag.use_sprites?
          .icon.sprite{:id => "sprite_#{@tag.position.to_s}"}
        - else
          .icon= image_tag(@tag.icon.url(:big)) if @tag.icon.present?
        %h2= link_to @sidebar_menu_tag.sidebar_title, tag_link(@sidebar_menu_tag), :style => "color: #{@tag.colour};"
        .section
          - @sidebar_menu_tag.entries.unmerged.each do |e|
            = render :partial => 'semi_static/tags/side_bar_entry', :locals => {:e => e}
  -# Exact same code used in site/home, refactor
  - if  obj.present? && obj.sidebar.present?
    - unless obj.sidebar.partial.blank? || obj.sidebar.partial == 'none'
      = render :partial => SemiStatic::Engine.config.open_partials[obj.sidebar.partial]
    - else
      .sidebar{:style => sidebar_style(obj.sidebar), :class => obj.sidebar.style_class }
        - unless obj.sidebar.title.blank?
          %h2= obj.sidebar.title
        = obj.sidebar.body.html_safe
  - unless obj.nil?
    = render :partial => 'semi_static/site/search' if obj.side_bar_search
    = render :partial => 'semi_static/site/social' if obj.side_bar_social
    = render :partial => 'semi_static/site/gallery' if obj.kind_of?(SemiStatic::Entry) && obj.side_bar_gallery
    = render :partial => 'semi_static/tags/news' if obj.side_bar_news || obj.side_bar_tag
